# Marzban Localized (Russian) & Xray v26 Support

## Быстрая установка (с нуля)
Для установки на чистый сервер (Ubuntu/Debian) выполните следующую команду:
```bash
sudo bash -c "$(curl -sL https://github.com/kellisfen/Marzban-RU-Xray-v26/raw/main/install.sh)"
```
*Скрипт автоматически установит Docker, Docker Compose, Git и настроит все необходимые компоненты.*

## Описание
Данный репозиторий содержит модифицированные файлы для проекта **Marzban**, обеспечивающие полную локализацию Telegram-бота на русский язык и совместимость с последними версиями **Xray-core (v26.2.2+)**.

## Основные изменения
- **Глубокая локализация на русский язык:**
  - Полностью переведен Telegram-бот (меню, кнопки, отчеты, системные сообщения).
  - Исправлены многочисленные ошибки в `admin.py`, включая "битые" строки (смесь английского и русского, некорректная кодировка).
  - Локализованы логгер-сообщения (теги #Создан, #Удален, #Пополнен и др.) для удобного мониторинга.
  - Добавлены корректные переводы статусов пользователей (Активен, Истек, Лимит исчерпан и т.д.).
- **Поддержка Xray-core v26:** 
  - Адаптирована логика работы с Reality (генерация x25519 ключей).
  - Исправлены ошибки импорта и конфигурации для новых версий ядра.
- **Улучшение UX/UI бота:**
  - Исправлена навигация (кнопка "Назад" теперь работает корректно во всех сценариях).
  - Оптимизировано bulk-создание пользователей с корректным запросом параметров.
  - Исправлено отображение заметок (notes) с поддержкой форматирования.
- **Безопасность и приватность:**
  - Проведена полная очистка от PII (персональных данных, IP-адресов, токенов).
  - Подготовлен шаблон `.env.example` с предустановленной локализацией `ru`.

## Автоматическое развертывание
Для упрощения процесса обновления и обслуживания добавлен скрипт `deploy.sh`.

### Функционал скрипта:
- **Проверка обновлений:** Сверяет локальную версию с удаленным репозиторием.
- **Резервное копирование:** Создает полный архив текущей версии перед изменениями.
- **Умное обновление:** Останавливает контейнеры, загружает новый код, обновляет Docker-образы.
- **Автоматические тесты:** Проверяет доступность API после запуска.
- **Откат (Rollback):** В случае ошибки автоматически возвращает систему к последнему рабочему бэкапу.
- **Уведомления:** Отправляет отчет о результате развертывания в ваш Telegram-канал (использует настройки из `.env`).

### Использование:
1. Дайте права на исполнение: `chmod +x deploy.sh`
2. Запустите скрипт: `./deploy.sh`

---
## Используемые технологии
- **Python 3.12**
- **Marzban** (Бэкенд и панель управления)
- **Xray-core v26.2.2**
- **Docker**

## Установка и запуск
Для применения данных изменений к вашей установке Marzban:

1. Склонируйте оригинальный репозиторий Marzban или используйте текущую установку.
2. Скопируйте файлы из папки `app/` данного репозитория в соответствующую папку `app/` вашей установки Marzban (обычно `/var/lib/marzban/` внутри контейнера или путь к исходному коду).
3. Обновите файл `.env`, добавив или изменив следующие параметры:
   ```env
   LOCALE=ru
   XRAY_EXECUTABLE_PATH=/var/lib/marzban/xray-core/xray
   ```
4. Убедитесь, что исполняемый файл Xray v26 находится по указанному пути.
5. Перезапустите Marzban:
   ```bash
   docker-compose restart marzban
   ```

## Архитектура решения
- `app/xray/core.py`: Модифицирован для поддержки нового формата вывода команды `x25519` в Xray v26.
- `app/xray/config.py`: Исправлен импорт и логика автоматического получения `publicKey` для Reality.
- `app/telegram/`: Содержит полностью локализованные обработчики и утилиты для Telegram-бота.

## Безопасность
В данном репозитории отсутствуют персональные данные, ключи доступа и токены. Все конфигурации приведены в виде шаблонов.

## Лицензия
Этот проект распространяется под лицензией **GPL-3.0**, в соответствии с оригинальной лицензией Marzban.

---
*Разработано в рамках задачи по улучшению и локализации Marzban.*
